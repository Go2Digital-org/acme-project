# Medium Priority Queue Workers
# Handles exports, reports, and general application tasks

# Export Queue Workers (Production: 2 processes, high memory)
[program:queue-exports]
process_name=%(program_name)s_%(process_num)02d
command=php artisan queue:work redis --queue=exports --tries=2 --max-time=0 --max-jobs=10 --memory=1024 --timeout=900 --sleep=5
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
priority=500
user=www-data
numprocs=%(ENV_QUEUE_EXPORTS_WORKERS)s
environment=
    APP_ENV="%(ENV_APP_ENV)s",
    QUEUE_CONNECTION="%(ENV_QUEUE_CONNECTION)s",
    REDIS_HOST="%(ENV_REDIS_HOST)s"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
killasgroup=true
stopasgroup=true
stopsignal=TERM
stopwaitsecs=1200

# Report Queue Workers (Production: 2 processes)
[program:queue-reports]
process_name=%(program_name)s_%(process_num)02d
command=php artisan queue:work redis --queue=reports --tries=3 --max-time=0 --max-jobs=20 --memory=512 --timeout=600 --sleep=3
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
priority=501
user=www-data
numprocs=%(ENV_QUEUE_REPORTS_WORKERS)s
environment=
    APP_ENV="%(ENV_APP_ENV)s",
    QUEUE_CONNECTION="%(ENV_QUEUE_CONNECTION)s",
    REDIS_HOST="%(ENV_REDIS_HOST)s"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
killasgroup=true
stopasgroup=true
stopsignal=TERM
stopwaitsecs=900

# Default Queue Workers (General application tasks)
[program:queue-default]
process_name=%(program_name)s_%(process_num)02d
command=php artisan queue:work redis --queue=default --tries=3 --max-time=3600 --max-jobs=100 --memory=256 --timeout=300 --sleep=3
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
priority=502
user=www-data
numprocs=%(ENV_QUEUE_DEFAULT_WORKERS)s
environment=
    APP_ENV="%(ENV_APP_ENV)s",
    QUEUE_CONNECTION="%(ENV_QUEUE_CONNECTION)s",
    REDIS_HOST="%(ENV_REDIS_HOST)s"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
killasgroup=true
stopasgroup=true
stopsignal=TERM
stopwaitsecs=600