# Low Priority Queue Workers
# Handles bulk operations, maintenance tasks, and background processing

# Bulk Processing Queue (Production: 1 process, high memory)
[program:queue-bulk]
process_name=%(program_name)s_%(process_num)02d
command=php artisan queue:work redis --queue=bulk --tries=1 --max-time=0 --max-jobs=5 --memory=1024 --timeout=3600 --sleep=10
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
priority=600
user=www-data
numprocs=%(ENV_QUEUE_BULK_WORKERS)s
environment=
    APP_ENV="%(ENV_APP_ENV)s",
    QUEUE_CONNECTION="%(ENV_QUEUE_CONNECTION)s",
    REDIS_HOST="%(ENV_REDIS_HOST)s"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
killasgroup=true
stopasgroup=true
stopsignal=TERM
stopwaitsecs=3900

# Maintenance Queue (Production: 1 process, lowest priority)
[program:queue-maintenance]
process_name=%(program_name)s_%(process_num)02d
command=php artisan queue:work redis --queue=maintenance --tries=1 --max-time=0 --max-jobs=1 --memory=256 --timeout=1800 --sleep=30
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
priority=601
user=www-data
numprocs=%(ENV_QUEUE_MAINTENANCE_WORKERS)s
environment=
    APP_ENV="%(ENV_APP_ENV)s",
    QUEUE_CONNECTION="%(ENV_QUEUE_CONNECTION)s",
    REDIS_HOST="%(ENV_REDIS_HOST)s"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
killasgroup=true
stopasgroup=true
stopsignal=TERM
stopwaitsecs=2100

# Cache Warming Worker (Background optimization)
[program:queue-cache-warming]
process_name=%(program_name)s_%(process_num)02d
command=php artisan queue:work redis --queue=cache-warming --tries=2 --max-time=0 --max-jobs=50 --memory=128 --timeout=300 --sleep=10
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
priority=602
user=www-data
numprocs=%(ENV_QUEUE_CACHE_WARMING_WORKERS)s
environment=
    APP_ENV="%(ENV_APP_ENV)s",
    QUEUE_CONNECTION="%(ENV_QUEUE_CONNECTION)s",
    REDIS_HOST="%(ENV_REDIS_HOST)s"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
killasgroup=true
stopasgroup=true
stopsignal=TERM
stopwaitsecs=600

# Cache Warming Orchestrator (Coordination process)
[program:queue-cache-warming-orchestrator]
process_name=%(program_name)s
command=php artisan queue:work redis --queue=cache-warming-orchestrator --tries=3 --max-time=0 --max-jobs=10 --memory=64 --timeout=120 --sleep=15
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
priority=603
user=www-data
numprocs=1
environment=
    APP_ENV="%(ENV_APP_ENV)s",
    QUEUE_CONNECTION="%(ENV_QUEUE_CONNECTION)s",
    REDIS_HOST="%(ENV_REDIS_HOST)s"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
killasgroup=true
stopasgroup=true
stopsignal=TERM
stopwaitsecs=300