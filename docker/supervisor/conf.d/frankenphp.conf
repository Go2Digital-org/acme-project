# FrankenPHP Web Server
# High-performance PHP application server with HTTP/3 support
[program:frankenphp]
command=frankenphp run --config /etc/caddy/Caddyfile
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=3
priority=100
user=www-data
environment=
    SERVER_NAME=":80,:443",
    FRANKENPHP_CONFIG="worker ./public/index.php"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
killasgroup=true
stopasgroup=true
stopsignal=QUIT
stopwaitsecs=10

# Health check process for FrankenPHP
[program:frankenphp-healthcheck]
command=/bin/bash -c 'while true; do curl -f http://localhost/health || exit 1; sleep 30; done'
directory=/app
autostart=true
autorestart=true
startretries=5
startsecs=10
priority=101
user=www-data
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr  
stderr_logfile_maxbytes=0
exitcodes=0,1